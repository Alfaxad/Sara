# Sara: Agent Overview

> **Stage:** Agent Development  
> **Model:** MedGemma 1.5 4B (fine-tuned)  
> **Status:** Fine-tuning and benchmarking complete, SOTA on select tasks

---

## Agent Architecture

Sara is a clinical workflow agent powered by fine-tuned MedGemma that executes FHIR operations through prompt-based tool calling.

### Core Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              SARA AGENT                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BRAIN                                                                â”‚   â”‚
â”‚  â”‚                                                                        â”‚   â”‚
â”‚  â”‚  MedGemma 1.5 4B (fine-tuned on MedAgentBench)                        â”‚   â”‚
â”‚  â”‚                                                                        â”‚   â”‚
â”‚  â”‚  Capabilities:                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Clinical reasoning     (inherited from base MedGemma)            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ FHIR query generation  (learned from trajectories)               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Dosing logic           (learned: Mg tiers, K formula)            â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Temporal reasoning     (learned: "stale" lab detection)          â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Multi-step planning    (learned: GET â†’ reason â†’ POST)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  OUTPUT FORMAT (Prompt-Based Tool Calling)                            â”‚   â”‚
â”‚  â”‚                                                                        â”‚   â”‚
â”‚  â”‚  The model outputs plain text in one of three formats:                â”‚   â”‚
â”‚  â”‚                                                                        â”‚   â”‚
â”‚  â”‚  READ:   GET http://localhost:8080/fhir/Observation?patient=X&code=Y  â”‚   â”‚
â”‚  â”‚  WRITE:  POST http://localhost:8080/fhir/MedicationRequest            â”‚   â”‚
â”‚  â”‚          {"resourceType": "MedicationRequest", ...}                   â”‚   â”‚
â”‚  â”‚  DONE:   FINISH(["answer"])                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Orchestration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXECUTION LOOP                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
â”‚  â”‚  START  â”‚                                                                â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                                â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â–¼                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  1. INJECT PROMPT                       â”‚                                â”‚
â”‚  â”‚                                         â”‚                                â”‚
â”‚  â”‚  System: "You are an expert in FHIR..." â”‚                                â”‚
â”‚  â”‚  Functions: [9 FHIR API definitions]    â”‚                                â”‚
â”‚  â”‚  Question: [task instruction]           â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  2. MODEL GENERATES                     â”‚                                â”‚
â”‚  â”‚                                         â”‚                                â”‚
â”‚  â”‚  MedGemma outputs one of:               â”‚                                â”‚
â”‚  â”‚  â€¢ GET url?params                       â”‚                                â”‚
â”‚  â”‚  â€¢ POST url + JSON                      â”‚                                â”‚
â”‚  â”‚  â€¢ FINISH([answer])                     â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                   â”‚                                                          â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  3. PARSE OUTPUT                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚                                         â”‚                   â”‚            â”‚
â”‚  â”‚  if GET  â†’ execute HTTP GET             â”‚                   â”‚            â”‚
â”‚  â”‚  if POST â†’ execute HTTP POST            â”‚                   â”‚            â”‚
â”‚  â”‚  if FINISH â†’ return answer              â”‚                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚            â”‚
â”‚                   â”‚                                             â”‚            â”‚
â”‚                   â–¼                                             â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚            â”‚
â”‚  â”‚  4. EXECUTE AGAINST FHIR SERVER         â”‚                   â”‚            â”‚
â”‚  â”‚                                         â”‚                   â”‚            â”‚
â”‚  â”‚  localhost:8080/fhir/* â†’ JSON response  â”‚                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚            â”‚
â”‚                   â”‚                                             â”‚            â”‚
â”‚                   â–¼                                             â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚            â”‚
â”‚  â”‚  5. INJECT RESULT INTO CONTEXT          â”‚                   â”‚            â”‚
â”‚  â”‚                                         â”‚                   â”‚            â”‚
â”‚  â”‚  "Here is the response: {Bundle...}"    â”‚                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚            â”‚
â”‚                   â”‚                                             â”‚            â”‚
â”‚                   â–¼                                             â”‚            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    No (round < 8)                     â”‚            â”‚
â”‚              â”‚ FINISH? â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                   â”‚ Yes                                                      â”‚
â”‚                   â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  6. RETURN ANSWER                       â”‚                                â”‚
â”‚  â”‚                                         â”‚                                â”‚
â”‚  â”‚  Extract answer from FINISH([...])      â”‚                                â”‚
â”‚  â”‚  Evaluate against ground truth          â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## FHIR Tools (9 Endpoints)

### READ Operations

| Tool | Endpoint | Purpose |
|------|----------|---------|
| **Patient.Search** | `GET /Patient` | Find patient by name, DOB, MRN |
| **Condition.Search** | `GET /Condition` | Query problem list |
| **Observation.Labs** | `GET /Observation` | Query lab results by LOINC code |
| **Observation.Vitals** | `GET /Observation` | Query vital signs |
| **MedicationRequest.Search** | `GET /MedicationRequest` | Query medication orders |
| **Procedure.Search** | `GET /Procedure` | Query completed procedures |

### WRITE Operations

| Tool | Endpoint | Purpose |
|------|----------|---------|
| **Observation.Create** | `POST /Observation` | Record vital signs |
| **MedicationRequest.Create** | `POST /MedicationRequest` | Create medication order |
| **ServiceRequest.Create** | `POST /ServiceRequest` | Create lab order / referral |

---

## Task Types (Demo Cards)

The demo presents 10 clickable task cards, one per MedAgentBench task type:

| Card | Task | Complexity | What Sara Does |
|------|------|------------|----------------|
| ğŸ” **Patient Lookup** | task1 | Simple | Find MRN by name + DOB |
| ğŸ‚ **Age Calculation** | task2 | Simple | Calculate patient age |
| ğŸ’“ **Record Vitals** | task3 | Simple | POST blood pressure reading |
| ğŸ§ª **Query Magnesium** | task4 | Medium | GET Mg level with date filter |
| ğŸ’Š **Treat Low Mg** | task5 | Hard | GET â†’ reason â†’ POST (dosing tiers) |
| ğŸ“Š **Average Glucose** | task6 | Medium | GET multiple values â†’ calculate mean |
| ğŸ©¸ **Latest Glucose** | task7 | Simple | GET most recent value |
| ğŸ¥ **Order Referral** | task8 | Medium | POST ServiceRequest with SNOMED + SBAR |
| âš¡ **Treat Low K** | task9 | Hard | GET â†’ reason â†’ POST med + POST follow-up |
| ğŸ“… **Stale HbA1c** | task10 | Hard | GET â†’ temporal check â†’ conditional POST |

### Demo Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DEMO INTERFACE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ğŸ” Patient  â”‚ â”‚ ğŸ‚ Age      â”‚ â”‚ ğŸ’“ Vitals   â”‚ â”‚ ğŸ§ª Query Mg â”‚            â”‚
â”‚  â”‚   Lookup    â”‚ â”‚   Calc      â”‚ â”‚   Record    â”‚ â”‚             â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ğŸ’Š Treat    â”‚ â”‚ ğŸ“Š Avg      â”‚ â”‚ ğŸ©¸ Latest   â”‚ â”‚ ğŸ¥ Order    â”‚            â”‚
â”‚  â”‚   Low Mg    â”‚ â”‚   Glucose   â”‚ â”‚   Glucose   â”‚ â”‚   Referral  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ âš¡ Treat    â”‚ â”‚ ğŸ“… Stale    â”‚                                            â”‚
â”‚  â”‚   Low K     â”‚ â”‚   HbA1c     â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                              â”‚
â”‚  User clicks "ğŸ’Š Treat Low Mg" card                                         â”‚
â”‚                     â”‚                                                        â”‚
â”‚                     â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Task: Check magnesium for patient S6200102. If low, order IV       â”‚    â”‚
â”‚  â”‚        replacement per protocol.                                    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Patient: S6200102                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                                                        â”‚
â”‚                     â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  EXECUTION TRACE                                                    â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Round 1:                                                           â”‚    â”‚
â”‚  â”‚  Sara: GET http://localhost:8080/fhir/Observation?patient=S6200102  â”‚    â”‚
â”‚  â”‚        &code=MG&date=ge2026-02-16                                   â”‚    â”‚
â”‚  â”‚  FHIR: {Bundle: Mg = 1.2 mg/dL}                                     â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Round 2:                                                           â”‚    â”‚
â”‚  â”‚  Sara: POST http://localhost:8080/fhir/MedicationRequest            â”‚    â”‚
â”‚  â”‚        {"resourceType": "MedicationRequest",                        â”‚    â”‚
â”‚  â”‚         "medicationCodeableConcept": {"text": "MgSO4 4g IV"},       â”‚    â”‚
â”‚  â”‚         "dosageInstruction": [{"doseQuantity": {"value": 4}}]...}   â”‚    â”‚
â”‚  â”‚  FHIR: Created successfully                                         â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Round 3:                                                           â”‚    â”‚
â”‚  â”‚  Sara: FINISH(["Magnesium 1.2 mg/dL (severe). Ordered 4g IV."])     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                     â”‚                                                        â”‚
â”‚                     â–¼                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  âœ“ ANSWER: Magnesium 1.2 mg/dL (severe). Ordered 4g IV MgSO4.       â”‚    â”‚
â”‚  â”‚  âœ“ STATUS: completedCorrect                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Clinical Reasoning Examples

### Task 5: Magnesium Replacement (Dosing Tiers)

```
INPUT:  Check magnesium for patient S6200102. If low, order replacement.

REASONING (learned from fine-tuning):
â”œâ”€â”€ Query Mg level
â”œâ”€â”€ Interpret result against thresholds:
â”‚   â”œâ”€â”€ Mg â‰¥ 2.0 mg/dL     â†’ Normal, no action
â”‚   â”œâ”€â”€ Mg 1.8-1.9 mg/dL   â†’ Mild, order 1g IV MgSO4
â”‚   â”œâ”€â”€ Mg 1.5-1.7 mg/dL   â†’ Moderate, order 2g IV MgSO4
â”‚   â””â”€â”€ Mg < 1.5 mg/dL     â†’ Severe, order 4g IV MgSO4
â””â”€â”€ Execute appropriate POST

OUTPUT: FINISH(["Magnesium 1.2 mg/dL (severe). Ordered 4g IV MgSO4."])
```

### Task 9: Potassium Replacement (Formula + Follow-up)

```
INPUT:  Check potassium for S1986380. If low, order replacement and AM recheck.

REASONING (learned from fine-tuning):
â”œâ”€â”€ Query K level
â”œâ”€â”€ If K < 3.5 mEq/L:
â”‚   â”œâ”€â”€ Calculate dose: 10 mEq per 0.1 below 3.5
â”‚   â”‚   â””â”€â”€ K = 3.2 â†’ deficit = 0.3 â†’ dose = 30 mEq
â”‚   â”œâ”€â”€ POST MedicationRequest (KCl 30 mEq PO)
â”‚   â””â”€â”€ POST ServiceRequest (serum K, scheduled 8am next day)
â””â”€â”€ Return summary

OUTPUT: FINISH(["K 3.2 mEq/L. Ordered 30 mEq KCl PO + AM recheck."])
```

### Task 10: Stale Lab Detection (Temporal Reasoning)

```
INPUT:  Check HbA1c for patient S3340529. Order new test if stale.

REASONING (learned from fine-tuning):
â”œâ”€â”€ Query HbA1c (code 4548-4)
â”œâ”€â”€ Check date of most recent result
â”œâ”€â”€ If date > 1 year ago:
â”‚   â””â”€â”€ POST ServiceRequest (HbA1c order, LOINC 4548-4)
â””â”€â”€ Return summary

OUTPUT: FINISH(["HbA1c 7.2% from 2024-01-15 (>1 year). Ordered new test."])
```

